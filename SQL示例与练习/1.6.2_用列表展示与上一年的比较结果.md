# 1.6.2 ç”¨åˆ—è¡¨å±•ç¤ºä¸Žä¸Šä¸€å¹´çš„æ¯”è¾ƒç»“æžœ

## é—®é¢˜:
**å‡†å¤‡æ•°æ®:**
```sql
create table sales (
    year int not null,
    sale int not null
);
insert into sales(year, sale)
            values(1990, 50),
                   (1991, 51),
                    (1992, 52),
                    (1993, 52),
                    (1994, 50),
                    (1995, 50),
                    (1996, 49),
                    (1997, 55);
/*
 year | sale
------+------
 1990 |   50
 1991 |   51
 1992 |   52
 1993 |   52
 1994 |   50
 1995 |   50
 1996 |   49
 1997 |   55
(8 rows)
```

**é—®é¢˜:**
æ¯”è¾ƒæ¯ä¸€å¹´ä¸Žä¸Šä¸€å¹´çš„é”€é‡, å¹¶è¾“å‡ºå¦‚ä¸‹ç»“æžœ:
```textmate
 year | sale | var
------+------+-----
 1990 |   50 | â–¬
 1991 |   51 | â†‘
 1992 |   52 | â†‘
 1993 |   52 | â†’
 1994 |   50 | â†“
 1995 |   50 | â†’
 1996 |   49 | â†“
 1997 |   55 | â†‘
```

## è§£æ³•:

### è§£æ³•ä¸€(ä½¿ç”¨å…³è”å­æŸ¥è¯¢):
```sql
select s1.year,
    s1.sale,
    case when s1.sale = (select sale from sales s2 where s2.year+1 = s1.year) then 'â†’'
        when s1.sale > (select sale from sales s2 where s2.year+1 = s1.year) then 'â†‘'
        when s1.sale < (select sale from sales s2 where s2.year+1 = s1.year) then 'â†“'
    else 'â–¬' end var
    from sales s1;
/*
 year | sale | var
------+------+-----
 1990 |   50 | â–¬
 1991 |   51 | â†‘
 1992 |   52 | â†‘
 1993 |   52 | â†’
 1994 |   50 | â†“
 1995 |   50 | â†’
 1996 |   49 | â†“
 1997 |   55 | â†‘
*/
```
### è§£æ³•äºŒ(ä½¿ç”¨å¤–è¿žæŽ¥):
```sql
select s1.year, s1.sale,
    case when s1.sale = s2.sale then 'â†’'
         when s1.sale > s2.sale then 'â†‘'
        when s1.sale < s2.sale then 'â†“'
    else 'â–¬' end var
    from sales s1 left outer join sales s2
        on s1.year = s2.year + 1;
/*
 year | sale | var
------+------+-----
 1990 |   50 | â–¬
 1991 |   51 | â†‘
 1992 |   52 | â†‘
 1993 |   52 | â†’
 1994 |   50 | â†“
 1995 |   50 | â†’
 1996 |   49 | â†“
 1997 |   55 | â†‘
*/
```

## é™„åŠ é¢˜:
ä¸Šä¸€é¢˜çš„æ—¶é—´è½´æ˜¯ç«–ç€çš„, çŽ°åœ¨æ”¹æˆæ¨ªç€çš„å±•ç¤ºè¯•ä¸€ä¸‹:
```textmate
 è¶‹åŠ¿ | 1990 | 1991 | 1992 | 1993 | 1994 | 1995 | 1996 | 1997
------+------+------+------+------+------+------+------+------
 å¹´ä»½ | â–¬    | â†‘    | â†‘    | â†’    | â†“    | â†’    | â†“    | â†‘
(1 row)
```
**è§£æ³•:**
```sql
select 'å¹´ä»½' "è¶‹åŠ¿",
        case when sum(case when s1.year = 1990 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1990 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1990 and s1.sale - s2.sale = 0 then 0 else null end) < 0 then 'â†“'
        else 'â–¬' end   "1990",
        case when sum(case when s1.year = 1991 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1991 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1991 and s1.sale - s2.sale = 0 then 0 else null end) = 0 then 'â†’'
        else 'â–¬' end "1991",
        case when sum(case when s1.year = 1992 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1992 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1992 and s1.sale - s2.sale = 0 then 0 else null end) = 0 then 'â†’'
        else 'â–¬' end "1992",
        case when sum(case when s1.year = 1993 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1993 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1993 and s1.sale - s2.sale = 0 then 0 else null end) =  0 then 'â†’'
        else 'â–¬' end "1993",
        case when sum(case when s1.year = 1994 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1994 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1994 and s1.sale - s2.sale = 0 then 0 else null end) =  0 then 'â†’'
        else 'â–¬' end "1994",
        case when sum(case when s1.year = 1995 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1995 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1995 and s1.sale - s2.sale = 0 then 0 else null end) =  0 then 'â†’'
        else 'â–¬' end "1995",
        case when sum(case when s1.year = 1996 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1996 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1996 and s1.sale - s2.sale = 0 then 0 else null end) =  0 then 'â†’'
        else 'â–¬' end "1996",
        case when sum(case when s1.year = 1997 and s1.sale - s2.sale > 0 then 1 else null end) > 0 then 'â†‘'
             when sum(case when s1.year = 1997 and s1.sale - s2.sale < 0 then -1 else null end) < 0 then 'â†“'
             when sum(case when s1.year = 1997 and s1.sale - s2.sale = 0 then 0 else null end) =  0 then 'â†’'
        else 'â–¬' end "1997"
    from sales s1
        left outer join sales s2
            on s1.year = s2.year+1;
/*
 è¶‹åŠ¿ | 1990 | 1991 | 1992 | 1993 | 1994 | 1995 | 1996 | 1997
------+------+------+------+------+------+------+------+------
 å¹´ä»½ | â–¬    | â†‘    | â†‘    | â†’    | â†“    | â†’    | â†“    | â†‘
(1 row)
*/
```
ðŸ’ è¿™æ ·å†™å¥½ç´¯å•Š ,æœ‰æ›´å¥½çš„æ–¹å¼å—?

