# 1.4.1 æŸ¥è¯¢ç¼ºå¤±çš„è¡Œ

## èƒŒæ™¯é—®é¢˜:
**å‡†å¤‡æ•°æ®:**
```sql
create table seq_tbl(
    seq int not null,
    name text not null
);
insert into seq_tbl(seq, name)
        values(1, 'è¿ªå…‹'),
                (2, 'å®‰'),
                (3, 'è±éœ²'),
                (5, 'å¡'),
                (6, 'ç›ä¸½'),
                (8, 'æœ¬');
/*
 seq | name
-----+------
   1 | è¿ªå…‹
   2 | å®‰
   3 | è±éœ²
   5 | å¡
   6 | ç›ä¸½
   8 | æœ¬
*/
```
**èƒŒæ™¯é—®é¢˜:**
* seqåˆ—æ˜¯å¦æ˜¯ä¸è¿ç»­çš„?
* ç¼ºå°‘çš„seqæ˜¯å“ªäº›?

### è§£æ³•:
**seqåˆ—æ˜¯å¦æ˜¯ä¸è¿ç»­çš„?**
```sql
select 'seqåˆ—æ˜¯ä¸è¿ç»­çš„' as gap
    from seq_tbl
having count(*) < max(seq);
/*
       gap
-----------------
 seqåˆ—æ˜¯ä¸è¿ç»­çš„
(1 row)
*/
```
ğŸ˜±havingå±…ç„¶å¯ä»¥è„±ç¦»group byä½¿ç”¨;

ğŸ¤“åœ¨ä»¥å‰çš„sqlæ ‡å‡†é‡Œ, havingå¿…é¡»å’Œgroup byä¸€èµ·ä½¿ç”¨çš„; ä½†æ˜¯åœ¨å½“å‰çš„sqlæ ‡å‡†é‡Œ, havingå¯ä»¥å•ç‹¬ä½¿ç”¨çš„, å¯ä»¥ç†è§£ä¸ºgroup byäº†ä¸€ä¸ªç©ºå­—æ®µ;
* group byçš„å­—æ®µè¶Šå¤šç†è®ºä¸Š, åˆ†å‡ºçš„è‡ªå·±å°±è¶Šå¤š, å¦‚ä¸‹å›¾æ‰€ç¤º:

<img width="427" alt="å›¾ç‰‡" src="https://user-images.githubusercontent.com/19871320/71704267-46301000-2e14-11ea-9ba1-57f243e713d0.png">

* è¿™ä¸€æ¡sqlè¯­å¥æ˜¯å¯¹ç©ºå­—æ®µè¿›è¡Œgroup by, é‚£ä¹ˆåˆ†å‡ºçš„å­é›†å°±æ˜¯é›†åˆæœ¬èº«, è¿™æ ·å°±æ˜¯å¯¹æ¯é›†æ±‚count(*), æ±‚max(income), å¦‚ä¸‹å›¾æ‰€ç¤º:

<img width="445" alt="å›¾ç‰‡" src="https://user-images.githubusercontent.com/19871320/71704348-c3f41b80-2e14-11ea-9c7d-fbfb08029339.png">


**ç¼ºå°‘çš„seqæ˜¯å“ªäº›?**
```sql
-- ä½¿ç”¨not in
select seq + 1 as gap
    from seq_tbl
where seq + 1 not in (select seq
                        from seq_tbl)
order by gqp;
/*
 gap
-----
   4
   7
   9
(3 rows)
*/

-- ä½¿ç”¨not exists â• å…³è”å­æŸ¥è¯¢
select seq + 1 as gap
    from seq_tbl as s1
where not exists (select *
                    from seq_tbl as s2
                where s1.seq+1 = s2.seq)
order by gap;
/*
 gap
-----
   4
   7
   9
*/
```

ğŸ¤“ order byä¸æ˜¯sqlè¿ç®—çš„ä¸€éƒ¨åˆ†, è€Œæ˜¯å…‰æ ‡å®šä¹‰çš„ä¸€éƒ¨åˆ†;

