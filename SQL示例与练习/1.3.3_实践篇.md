# 1.3.3 å®è·µç¯‡

## å‡ ç§å› ä¸ºnullçš„å­˜åœ¨è€Œéœ€è¦æ³¨æ„çš„åœ°æ–¹

<img width="443" alt="å›¾ç‰‡" src="https://user-images.githubusercontent.com/19871320/71650052-7319ef80-2d4e-11ea-8e98-9c3a1b02bddd.png">

### æ¯”è¾ƒè°“è¯ä¸null: æ’ä¸­å¾‹ä¸å­˜åœ¨
**å‡†å¤‡æ•°æ®:**
```sql
create table students(
    name text not null,
    age int
);
insert into students(name, age)
        values('å¸ƒæœ—', 22),
            ('æ‹‰é‡Œ', 19),
            ('çº¦ç¿°', null),
            ('ä¼¯æ°', 21);
/*
 name | age
------+-----
 å¸ƒæœ— |  22
 æ‹‰é‡Œ |  19
 çº¦ç¿° |
 ä¼¯æ° |  21
*/
```
**ç”¨sqlè¯­å¥æŸ¥æ‰¾æ‰€æœ‰çš„æ•°æ®:**
```sql
select *
    from students
where age = 21 or age <> 21;
/*
 name | age
------+-----
 å¸ƒæœ— |  22
 æ‹‰é‡Œ |  19
 ä¼¯æ° |  21
*/
```
ğŸ˜±æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰æŸ¥åˆ°çº¦ç¿°;
å› ä¸ºnullçš„å­˜åœ¨,å¯¼è‡´æ’ä¸­å¾‹åœ¨sqlä¸­å¹¶ä¸å­˜åœ¨

### æ¯”è¾ƒè°“è¯ä¸null: caseè¡¨è¾¾å¼å’Œnull
ä½¿ç”¨ä¸‹é¢çš„sqlè¯­å¥
```sql
select case col_1 when 1 then 'âˆš'
                when null then 'Ã—'
from ...
```
ä¼šå‘ç°æ°¸è¿œä¸å¯èƒ½å‡ºç° "Ã—", å› ä¸ºä¸Šé¢çš„sqlç­‰ä»·äº
```sql
select case when col_1 = 1 then 'âˆš'
            when col_1 = null then 'Ã—'
from ...
       -->ç­‰ä»·äº<--
select case when col_1 = 1 then 'âˆš'
            when unknown then 'Ã—'
from ...
```
æ‰€ä»¥æ°¸è¿œä¸å¯èƒ½æ‰§è¡Œ

### not in å’Œnot existä¸æ˜¯ç­‰ä»·çš„

> ç»“è®º:
> åœ¨sqlä¸­inä¸existsæ˜¯ç­‰ä»·çš„, ä½†æ˜¯not inä¸not existsä¸æ˜¯ç­‰ä»·çš„

#### å‡†å¤‡æ•°æ®:
```sql
create table class_a(
    name text not null,
    age int not null,
    city text not null
);
insert into class_a(name, age, city)
            values('å¸ƒæœ—', 22, 'ä¸œäº¬'),
                   ('æ‹‰é‡Œ', 19, 'ç¦ç‰'),
                    ('ä¼¯æ°', 21, 'åƒå¶');
/*
 name | age | city
------+-----+------
 å¸ƒæœ— |  22 | ä¸œäº¬
 æ‹‰é‡Œ |  19 | ç¦ç‰
 ä¼¯æ° |  21 | åƒå¶
*/
create table class_b(
    name text not null,
    age int,
    city text not null
);
insert into class_b(name, age, city)
            values('é½è—¤', 22, 'ä¸œäº¬'),
                    ('ç”°å°»', 23, 'ä¸œäº¬'),
                    ('å±±ç”°', null, 'ä¸œäº¬'),
                    ('å’Œæ³‰', 18, 'åƒå¶'),
                    ('æ­¦ç”°', 20, 'åƒå¶'),
                    ('çŸ³å·', 19, 'ç¥å¥ˆå·');       
/*
 name | age |  city
------+-----+--------
 é½è—¤ |  22 | ä¸œäº¬
 ç”°å°» |  23 | ä¸œäº¬
 å±±ç”° |     | ä¸œäº¬
 å’Œæ³‰ |  18 | åƒå¶
 æ­¦ç”° |  20 | åƒå¶
 çŸ³å· |  19 | ç¥å¥ˆå·
*/        
```

### èƒŒæ™¯é—®é¢˜:
ä»class_aä¸­æŸ¥æ‰¾ä¸class_bä¸­ä½åœ¨ä¸œäº¬ä½†æ˜¯å¹´é¾„ä¸åŒçš„å­¦ç”Ÿ

**ä½¿ç”¨è°“è¯not inæŸ¥æ‰¾å±…ç„¶æŸ¥ä¸åˆ°!**
```sql
select *
    from class_a
where age not in (select age
                    from class_b
                where city = 'ä¸œäº¬');
/*
 name | age | city
------+-----+------
(0 rows)
*/
```
**ä½¿ç”¨not existså´å¯ä»¥æŸ¥åˆ°:**
```postgresql
select *
    from class_a
where not exists (select *
                    from class_b
                where city = 'ä¸œäº¬'
                    and class_a.age = class_b.age);
/*
 name | age | city
------+-----+------
 æ‹‰é‡Œ |  19 | ç¦ç‰
 ä¼¯æ° |  21 | åƒå¶
*/
```

### ä¸ºä½•ä¼šå­˜åœ¨ä¸Šè¿°é—®é¢˜:
> å…¨éƒ½æ˜¯nullçš„é”…

#### ä¸Šè¿°not inç­‰ä»·äº:
```sql
select *
    from class_a
where age not in (select age
                    from class_b
                where city = 'ä¸œäº¬');
         -->ç­‰ä»·äº<--
select *
    from class_a
where age not in (22, 23, null);
         -->ç­‰ä»·äº<--
select *
    from class_a
where not((age = 22)
        or (age = 23)
        or (age = null));
        -->ç­‰ä»·äºğŸ¤”(ä¸ºå•¥)<--
select *
    from class_a
where not(age = 22)
        and not(age = 23)
        and not(age = null);
        -->ç­‰ä»·äº<--
select *
    from class_a
where ((age <> 22)
        and (age <> 23)
        and (age <> null));
        -->ç­‰ä»·äº<--
select *
    from class_a
where (age <> 22)
        and (age <> 23)
        and unknown;
        -->ç­‰ä»·äº<--
select *
    from class_a
where unknown;

-- éš¾æ€ªæœ€ç»ˆå¾—ä¸åˆ°ä»»ä½•å€¼ğŸ˜±
```

#### not existså¤„ç†nullçš„æ–¹å¼:
```sql
select *
    from class_a
where not exists (select *
                    from class_b
                where city = 'ä¸œäº¬'
                    and class_a.age = class_b.age);
        -->ç­‰ä»·äº<--
select *
    from class_a
where not exists (select *
                    from class_b
                where city = 'ä¸œäº¬'
                    and class_a.age = null);
        -->ç­‰ä»·äº<--
select *
    from class_a
where not exist (select *
                    from class_b
                where city = 'ä¸œäº¬'
                    and unknown);
        -->ç­‰ä»·äº<--
select *
    from class_a
where not exist (select *
                    from class_b
                where unknown);
        -->ç­‰ä»·äº<--
select *
    from class_a
where not false;
        -->ç­‰ä»·äº<--
select *
    from class_a
where true;
```

### é™å®šè°“è¯å’ŒNULL

#### é™å®šè°“è¯ANYä¸ALLä½œç”¨

**any:**
> Use the ANY operator in a WHERE clause to compare a value with any of the values in a list.
> You must place an =, <>, <, >, <=, or >= operator before ANY.

```sql
SELECT *
  FROM employee
  -- WHERE salary > ANY (2000, 3000, 4000); è¿™æ ·å†™ä¼šæŠ¥é”™ å› ä¸ºanyåé¢è¦è·Ÿä¸€ä¸ªæ•°ç»„, ä½†æ˜¯è¿™ä¸ªä¸æ˜¯æ•°ç»„
WHERE salary > ANY values((2000), (3000), (4000));
```
**all:**
> Use the IN operator in a WHERE clause to compare a value with any of the values in a list.
> You must place an =, <>, <, >, <=, or >= operator before ALL.

```sql
SELECT *
  FROM employee
-- WHERE salary > ALL (2000, 3000, 4000) è¿™æ ·å†™ä¼šæŠ¥é”™ å› ä¸ºanyåé¢è¦è·Ÿä¸€ä¸ªæ•°ç»„, ä½†æ˜¯è¿™ä¸ªä¸æ˜¯æ•°ç»„
WHERE salary > ALL values((2000), (3000), (4000));
```

#### é™å®šè°“è¯ANYä¸ALL vs IN:

* IN ç­‰ä»·äº = ANy
* NOT IN ç­‰ä»·äº <> ALL

#### ALL ä¸ NULL å¼•å‘çš„é—®é¢˜:

**èƒŒæ™¯é—®é¢˜:**
ä»class_aä¸­æ‰¾å‡ºæ‰€æœ‰å¹´é¾„æ¯”class_bä¸­åœ¨ä¸œäº¬å±…ä½çš„å°çš„å­¦ç”Ÿ
```textmate
class_a
 name | age | city
------+-----+------
 å¸ƒæœ— |  22 | ä¸œäº¬
 æ‹‰é‡Œ |  19 | ç¦ç‰
 ä¼¯æ° |  21 | åƒå¶

class_b
 name | age |  city
------+-----+--------
 é½è—¤ |  22 | ä¸œäº¬
 ç”°å°» |  23 | ä¸œäº¬
 å±±ç”° |     | ä¸œäº¬
 å’Œæ³‰ |  18 | åƒå¶
 æ­¦ç”° |  20 | åƒå¶
 çŸ³å· |  19 | ç¥å¥ˆå·
```
å½“ä½¿ç”¨å¦‚ä¸‹sqlè¯­å¥:
```sql
select *
    from class_a
where age < all(select age
                    from class_b
                where city = 'ä¸œäº¬');
/*
 name | age | city
------+-----+------
(0 rows)
*/
```ğŸ˜±

**ä¸ºå•¥å•¥éƒ½æŸ¥ä¸åˆ°?**
> nullçš„é”…!
å› ä¸ºallå°±æ˜¯andçš„è¯­æ³•ç³–,
æ‰€ä»¥åœ¨allçš„å¤„ç†nullçš„æ—¶å€™ç­‰ä»·äº:
```sql
select ****
from ***
where true and false and unknown;
```
ç­‰ä»·äº
```sql
select ***
from ***
where unknown;
```

### é™å®šè°“è¯ä¸æè‡´å‡½æ•°æ˜¯ä¸ç­‰ä»·çš„

**æè‡´å‡½æ•°(maxæˆ–è€…min)ä¼šè¿‡æ»¤æ‰null**
```sql
select *
    from class_a
where age < all(select age
                    from class_b
                where city = 'ä¸œäº¬');
/*
 name | age | city
------+-----+------
(0 rows)
*/

select * from class_a
where age < (select min(age) from class_b where city = 'ä¸œäº¬');
 name | age | city
/*
------+-----+------
 æ‹‰é‡Œ |  19 | ç¦ç‰
 ä¼¯æ° |  21 | åƒå¶
(2 rows)
*/
```

**åœ¨æŸ¥è¯¢ä¸åˆ°ä»»ä½•åˆ—æ—¶, æè‡´å‡½æ•°maxæˆ–minä¼šè¿”å›null:**

```sql
select *
    from class_a
where age < all (select age
                    from class_b
                where city <> 'ä¸œäº¬'
                    and city = 'ä¸œäº¬');
/*
 name | age | city
------+-----+------
 å¸ƒæœ— |  22 | ä¸œäº¬
 æ‹‰é‡Œ |  19 | ç¦ç‰
 ä¼¯æ° |  21 | åƒå¶
(3 rows)
*/
select *
    from class_a
where age < (select max(age)
                from class_b
            where city <> 'ä¸œäº¬'
                and city = 'ä¸œäº¬');
/*
 name | age | city
------+-----+------
(0 rows)
*/
```

### èšåˆå‡½æ•°ä¸NULL
> èšåˆå‡½æ•°ä¸­é™¤äº†count, å…¶ä»–çš„è¾“å…¥ç©ºé›†éƒ½ä¼šè¿”å›null
```sql
select *
    from class_a
where age < (select avg(age)
                from class_b
            where false);
/*
 name | age | city
------+-----+------
(0 rows)
*/
```
