# 1.5.4 ä½œä¸ºä¹˜æ³•è¿ç®—çš„è¿æ¥

## é—®é¢˜:

### å‡†å¤‡æ•°æ®:
```sql
create table items2(
    item_no int not null unique,
    item varchar(100) not null unique 
);
insert into items2(item_no, item)
            values(10, 'FD'),
                    (20, 'CD-R'),
                    (30, 'MO'),
                    (40, 'DVD');
/*
 item_no | item
---------+------
      10 | FD
      20 | CD-R
      30 | MO
      40 | DVD
(4 rows)
*/

create table sales_history(
    sale_date date not null,
    item_no int not null,
    quantity int not null 
);
insert into sales_history(sale_date, item_no, quantity)
            values('2017-10-01', 10, 4),
                    ('2017-10-01', 20, 10),
                    ('2017-10-01', 30, 3),
                    ('2017-10-03', 10, 32),
                    ('2017-10-03', 30, 12),
                    ('2017-10-04', 20, 22),
                    ('2017-10-04', 30, 7);
/*
 sale_date  | item_no | quantity
------------+---------+----------
 2017-10-01 |      10 |        4
 2017-10-01 |      20 |       10
 2017-10-01 |      30 |        3
 2017-10-03 |      10 |       32
 2017-10-03 |      30 |       12
 2017-10-04 |      20 |       22
 2017-10-04 |      30 |        7
(7 rows)
*/
```

### é—®é¢˜:
ç»Ÿè®¡æ¯ä¸ªå•†å“é”€å”®çš„æ€»é‡, ç”Ÿæˆå¦‚ä¸‹è¡¨æ ¼
```textmate
 item_no | sum
---------+-----
      10 |  36
      20 |  32
      30 |  22
      40 |
(4 rows)
```

## è§£æ³•:

### è§£æ³•ä¸€(å…ˆç”Ÿæˆä¸€ä¸ªè§†å›¾åœ¨è¿›è¡Œå¤–è¿æ¥):
```sql
select i.item_no, sh.quantity
    from (select sales_history.item_no, sum(quantity) quantity
            from sales_history
          group by  sales_history.item_no) sh
        right outer join items2 i
            on i.item_no = sh.item_no
order by i.item_no;
/*
 item_no | quantity
---------+----------
      10 |       36
      20 |       32
      30 |       22
      40 |
(4 rows)
*/
```
ğŸ’€è¿™æ ·å†™è™½ç„¶å¯ä»¥å®Œæˆç»Ÿè®¡, ä½†æ˜¯å› ä¸ºä¸­é—´ç”Ÿæˆäº†ä¸€ä¸ªè§†å›¾, è€Œç”Ÿæˆè§†å›¾å°±è¦å ç”¨å†…å­˜, è¿™æ ·ä¸å¤Ÿå¥½, éœ€è¦ä¼˜åŒ–;

### è§£æ³•äºŒ(å…ˆå¤–è¿æ¥å†åˆ†ç»„è®¡ç®—æ•°é‡, é¿å…è§†å›¾çš„ç”Ÿæˆ):
```sql
select i.item_no, sum(sh.quantity) quantity
    from items2 i
        left outer join sales_history sh
            on i.item_no = sh.item_no
group by i.item_no
order by i.item_no;
/*
 item_no | quantity
---------+----------
      10 |       36
      20 |       32
      30 |       22
      40 |
(4 rows)
*/
```
æ³¨æ„: è¿™é‡Œå› ä¸ºitems2è¡¨ä¸­çš„item_noæ˜¯å”¯ä¸€çš„, æ‰€ä»¥ä¸ä¼šå› ä¸ºç¬›å¡å°”ç§¯å¯¼è‡´æ€»æ•°ç®—é”™, å› ä¸º1*n=n;
è‹¥æ˜¯items2ä¸­çš„item_noä¸æ˜¯æƒŸä¸€çš„å°±è¦åšé¢å¤–çš„è€ƒè™‘äº†;
