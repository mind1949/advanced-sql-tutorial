# 1.6.3 æ—¶é—´è½´æœ‰é—´æ–­æ—¶, å’Œè¿‡å»æœ€é‚»è¿‘çš„æ—¶é—´æ¯”è¾ƒ

## å‡†å¤‡æ•°æ®:
```sql
create table sales2 (
    year int not null,
    sale int not null
);
insert into sales2(year, sale)
            values(1990, 50),
                    (1992, 52),
                    (1993, 52),
                    (1994, 55),
                    (1997, 55);
/*
 year | sale
------+------
 1990 |   50
 1992 |   52
 1993 |   52
 1994 |   55
 1997 |   55
(5 rows)
*/
```

## é—®é¢˜:
ä¸Šé¢çš„æ•°æ®ç¼ºå°‘äº†1991/1995å’Œ1996çš„, æˆ‘ä»¬å†æƒ³åƒå‰é¢ä¸€æ ·æ¯”è¾ƒä¸Šä¸€å¹´çš„å°±ä¸å¯èƒ½äº†, æ‰€ä»¥ç°åœ¨æ”¹æˆæ¯”è¾ƒè¿‡å»æœ€è¿‘ä¸€å¹´çš„æ•°æ®.
å¾—åˆ°å¦‚ä¸‹è¾“å‡º:
```textmate
```

## è§£æ³•:

### è§£æ³•ä¸€(ä½¿ç”¨å¤–(å†…)è¿æ¥+æå€¼å‡½æ•°MAX):
```sql
select s1.year, s1.sale
    from sales2 s1
        left outer join sales2 s2
            on s2.year < s1.year
                and s2.year = (select max(year)
                                    from sales2 s3
                                where s3.year < s1.year)
where s1.sale = s2.sale
order by s1.year;

-- æˆ–è€…
select s1.year, s1.sale
    from sales2 s1, sales2 s2
where s1.sale = s2.sale
    and s2.year = (select max(year)
                      from sales2 s3
                    where s3.year < s1.year);

/*
 year | sale
------+------
 1993 |   52
 1997 |   55
(2 rows)
*/
```

### è§£æ³•äºŒ(ä½¿ç”¨å¤–(å†…)è¿æ¥+é™å®šè°“è¯EXISTS):
```sql
select s1.year, s1.sale
    from sales2 s1
        left outer join sales2 s2
            on s2.year < s1.year
                and not exists (select *
                                    from sales2 s3
                                where s3.year < s1.year
                                    and s3.year > s2.year)
where s1.sale = s2.sale
order by s1.year;

-- æˆ–è€…
select s1.year, s1.sale
    from sales2 s1, sales2 s2
where s1.sale = s2.sale
    and s1.year > s2.year
    and not exists (select *
                        from sales2 s3
                    where s3.year < s1.year
                        and s3.year > s2.year);
/*
 year | sale
------+------
 1993 |   52
 1997 |   55
(2 rows)
*/
```

### ä½¿ç”¨å…³è”å­æŸ¥è¯¢:
```sql
select s1.year, s1.sale
    from sales2 s1
where s1.sale = (select s2.sale
                    from sales2 s2
                where s2.year = (select max(s3.year)
                                    from sales2 s3
                                where s3.year < s1.year));
/*
 year | sale
------+------
 1993 |   52
 1997 |   55
(2 rows)
*/
-- æˆ–è€…
select s1.year, s1.sale
    from sales2 s1
where exists (select *
                from sales s2
             where s2.year = (select max(s3.year)
                                from sales2 s3
                            where s3.year < s1.year)
                and s2.sale = s1.sale);
/*
 year | sale
------+------
 1993 |   52
(1 row)
*/
-- ğŸ¤”è¿™ä¸ªä¸ºä»€ä¹ˆæ˜¯é”™çš„å‘¢?
```



